x-logging: &default-logging
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"

services:
  basecard-miniapp:
    build:
      context: .
      args:
        NEXT_PUBLIC_BACKEND_API_URL: ${NEXT_PUBLIC_BACKEND_API_URL}
        NEXT_PUBLIC_URL: ${NEXT_PUBLIC_URL}
        NEXT_PUBLIC_PROJECT_NAME: ${NEXT_PUBLIC_PROJECT_NAME}
        NEXT_PUBLIC_ONCHAINKIT_API_KEY: ${NEXT_PUBLIC_ONCHAINKIT_API_KEY}
        NEXT_PUBLIC_CDP_CLIENT_API_KEY: ${NEXT_PUBLIC_CDP_CLIENT_API_KEY}
        NEXT_PUBLIC_CDP_CLIENT_API_KEY_SECRET: ${NEXT_PUBLIC_CDP_CLIENT_API_KEY_SECRET}
    container_name: basecard-miniapp-local
    restart: always
    env_file:
      - .env
    logging: *default-logging
    networks:
      - miniapp-network
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 20s

  # tunnel:
  #   image: cloudflare/cloudflared:latest
  #   container_name: miniapp-tunnel
  #   restart: always
  #   command: tunnel run
  #   environment:
  #     - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
  #   logging: *default-logging
  #   networks:
  #     - miniapp-network

networks:
  miniapp-network:
    driver: bridge
