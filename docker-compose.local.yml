x-logging: &default-logging
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"

services:
  basecard-miniapp:
    build:
      context: .
    container_name: basecard-miniapp-local
    restart: always
    env_file:
      - .env
    logging: *default-logging
    networks:
      - miniapp-network
    healthcheck:
      test:
        ["CMD", "wget", "-q", "--spider", "http://localhost:3000/api/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 20s

  # tunnel:
  #   image: cloudflare/cloudflared:latest
  #   container_name: miniapp-tunnel
  #   restart: always
  #   command: tunnel run
  #   environment:
  #     - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
  #   logging: *default-logging
  #   networks:
  #     - miniapp-network

networks:
  miniapp-network:
    driver: bridge
